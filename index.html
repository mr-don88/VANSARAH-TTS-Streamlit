<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text to Speech Studio - Chuyển văn bản thành giọng nói</title>
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3f37c9;
            --success-color: #4cc9f0;
            --dark-color: #1a1a2e;
            --light-color: #f8f9fa;
            --card-bg: #ffffff;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            --border-radius: 12px;
        }
        
        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
            min-height: 100vh;
            padding-bottom: 40px;
        }
        
        .language-selector {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: var(--border-radius);
            padding: 2rem;
            margin-bottom: 2rem;
            color: white;
            box-shadow: var(--shadow);
        }
        
        .card {
            border: none;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 1.5rem;
            transition: transform 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: var(--border-radius) var(--border-radius) 0 0 !important;
            padding: 1rem 1.5rem;
            font-weight: 600;
        }
        
        .nav-tabs {
            border-bottom: 2px solid rgba(67, 97, 238, 0.1);
        }
        
        .nav-tabs .nav-link {
            border: none;
            color: #666;
            font-weight: 500;
            padding: 0.75rem 1.5rem;
            margin: 0 0.25rem;
            border-radius: 8px 8px 0 0;
            transition: all 0.3s ease;
        }
        
        .nav-tabs .nav-link:hover {
            color: var(--primary-color);
            background: rgba(67, 97, 238, 0.05);
        }
        
        .nav-tabs .nav-link.active {
            color: var(--primary-color);
            background: white;
            border-bottom: 3px solid var(--primary-color);
            font-weight: 600;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border: none;
            border-radius: 8px;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(67, 97, 238, 0.3);
        }
        
        .form-control, .form-select {
            border-radius: 8px;
            border: 1px solid #ddd;
            padding: 0.75rem;
            transition: all 0.3s ease;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem rgba(67, 97, 238, 0.25);
        }
        
        .slider-container {
            padding: 1rem 0;
        }
        
        .audio-player {
            width: 100%;
            margin: 1.5rem 0;
            border-radius: var(--border-radius);
            overflow: hidden;
        }
        
        .subtitle-box {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 1rem;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
        }
        
        .settings-accordion .accordion-button {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 8px !important;
            font-weight: 600;
            color: var(--dark-color);
        }
        
        .char-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-weight: 600;
            margin: 0.25rem;
            font-size: 0.85rem;
        }
        
        .char1-badge { background: #4cc9f0; color: white; }
        .char2-badge { background: #7209b7; color: white; }
        .char3-badge { background: #f72585; color: white; }
        .q-badge { background: #4361ee; color: white; }
        .a-badge { background: #38b000; color: white; }
        
        .loading-spinner {
            display: none;
            text-align: center;
            padding: 2rem;
        }
        
        .feature-icon {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }
        
        .footer {
            text-align: center;
            margin-top: 3rem;
            padding: 1.5rem;
            color: #666;
            font-size: 0.9rem;
        }
        
        .progress {
            height: 8px;
            border-radius: 4px;
            margin: 10px 0;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 0 15px;
            }
            
            .header {
                padding: 1.5rem;
                text-align: center;
            }
            
            .language-selector {
                position: static;
                margin-bottom: 1rem;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <!-- Language Selector -->
    <div class="language-selector">
        <select id="language-select" class="form-select form-select-sm" style="width: auto;">
            <option value="vi">Tiếng Việt</option>
            <option value="en">English</option>
        </select>
    </div>

    <div class="container mt-5">
        <!-- Header -->
        <div class="header text-center">
            <h1><i class="fas fa-microphone-alt me-3"></i> <span id="title">Text to Speech Studio</span></h1>
            <p class="lead mb-0" id="subtitle">Chuyển văn bản thành giọng nói chuyên nghiệp với Microsoft Edge TTS</p>
        </div>

        <!-- Main Content -->
        <div class="card">
            <!-- Navigation Tabs -->
            <ul class="nav nav-tabs px-3 pt-3" id="myTab" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="single-tab" data-bs-toggle="tab" data-bs-target="#single" type="button" role="tab">
                        <i class="fas fa-user me-2"></i> <span>1 Nhân vật</span>
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="multi-tab" data-bs-toggle="tab" data-bs-target="#multi" type="button" role="tab">
                        <i class="fas fa-users me-2"></i> <span>Đa nhân vật</span>
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="qa-tab" data-bs-toggle="tab" data-bs-target="#qa" type="button" role="tab">
                        <i class="fas fa-comments me-2"></i> <span>Hỏi & Đáp</span>
                    </button>
                </li>
            </ul>

            <!-- Tab Content -->
            <div class="tab-content p-4" id="myTabContent">
                <!-- Tab 1: Single Character -->
                <div class="tab-pane fade show active" id="single" role="tabpanel">
                    <div class="row">
                        <div class="col-lg-6">
                            <div class="mb-3">
                                <label for="single-text" class="form-label">Nội dung truyện</label>
                                <textarea class="form-control" id="single-text" rows="10" placeholder="Nhập nội dung truyện (mỗi dòng là một đoạn)...">Xin chào! Đây là bản demo của công cụ Text to Speech. Công cụ này sử dụng Microsoft Edge TTS để tạo giọng nói chất lượng cao.</textarea>
                                <div class="form-text">Nhập văn bản cần chuyển thành giọng nói (tối đa 5000 ký tự)</div>
                            </div>
                            
                            <div class="row g-3 mb-3">
                                <div class="col-md-6">
                                    <label for="single-language" class="form-label">Ngôn ngữ</label>
                                    <select class="form-select" id="single-language">
                                        <option value="vi-VN">Tiếng Việt</option>
                                        <option value="en-US">English (US)</option>
                                        <option value="en-GB">English (UK)</option>
                                        <option value="fr-FR">Français</option>
                                        <option value="es-ES">Español</option>
                                        <option value="de-DE">Deutsch</option>
                                        <option value="ja-JP">日本語</option>
                                        <option value="ko-KR">한국어</option>
                                        <option value="zh-CN">中文 (简体)</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label for="single-voice" class="form-label">Giọng đọc</label>
                                    <select class="form-select" id="single-voice">
                                        <!-- Voices will be populated based on language -->
                                    </select>
                                </div>
                            </div>
                            
                            <div class="slider-container">
                                <label for="single-rate" class="form-label">Tốc độ: <span id="single-rate-value">0%</span></label>
                                <input type="range" class="form-range" id="single-rate" min="-50" max="50" step="5" value="0">
                            </div>
                            
                            <div class="slider-container">
                                <label for="single-volume" class="form-label">Âm lượng: <span id="single-volume-value">100%</span></label>
                                <input type="range" class="form-range" id="single-volume" min="0" max="200" step="10" value="100">
                            </div>
                            
                            <div class="slider-container mb-4">
                                <label for="single-pause" class="form-label">Khoảng nghỉ giữa đoạn: <span id="single-pause-value">300ms</span></label>
                                <input type="range" class="form-range" id="single-pause" min="100" max="1000" step="50" value="300">
                            </div>
                            
                            <div class="mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="single-subtitle" checked>
                                    <label class="form-check-label" for="single-subtitle">Tạo phụ đề tự động (.srt)</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="single-save-settings">
                                    <label class="form-check-label" for="single-save-settings">Lưu cài đặt</label>
                                </div>
                            </div>
                            
                            <button class="btn btn-primary w-100" id="single-generate">
                                <i class="fas fa-microphone-alt me-2"></i> Tạo audio từ văn bản
                            </button>
                            
                            <div class="progress mt-3" id="single-progress" style="display: none;">
                                <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%"></div>
                            </div>
                        </div>
                        
                        <div class="col-lg-6">
                            <div class="loading-spinner" id="single-loading">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Đang xử lý...</span>
                                </div>
                                <p class="mt-3">Đang xử lý văn bản và tạo audio...</p>
                            </div>
                            
                            <div id="single-results" style="display: none;">
                                <div class="mb-3">
                                    <label class="form-label">Audio đã tạo</label>
                                    <audio controls class="audio-player" id="single-audio-player"></audio>
                                    <div class="d-flex gap-2 mt-2">
                                        <button class="btn btn-outline-primary btn-sm" id="single-download-audio">
                                            <i class="fas fa-download me-1"></i> Tải audio (.mp3)
                                        </button>
                                        <button class="btn btn-outline-success btn-sm" id="single-download-srt" style="display: none;">
                                            <i class="fas fa-file-alt me-1"></i> Tải phụ đề (.srt)
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Thông tin</label>
                                    <div class="alert alert-info" id="single-status">
                                        <i class="fas fa-info-circle me-2"></i> Chưa có audio được tạo
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Nội dung phụ đề</label>
                                    <div class="subtitle-box" id="single-subtitles">Chưa có phụ đề</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tab 2: Multi Character -->
                <div class="tab-pane fade" id="multi" role="tabpanel">
                    <div class="row">
                        <div class="col-lg-6">
                            <div class="mb-3">
                                <label for="multi-text" class="form-label">Nội dung câu chuyện đa nhân vật</label>
                                <textarea class="form-control" id="multi-text" rows="10" placeholder="CHAR1: Lời thoại nhân vật 1&#10;CHAR2: Lời thoại nhân vật 2&#10;CHAR3: Lời thoại nhân vật 3&#10;NARRATOR: Lời dẫn truyện">CHAR1: Xin chào, tôi là nhân vật số 1.&#10;CHAR2: Chào bạn, tôi là nhân vật số 2.&#10;CHAR1: Hôm nay chúng ta sẽ thảo luận về công nghệ Text to Speech.&#10;CHAR2: Đó là một công nghệ rất thú vị và hữu ích.</textarea>
                                <div class="form-text mt-2">
                                    Sử dụng tiền tố: 
                                    <span class="char-badge char1-badge">CHAR1:</span>
                                    <span class="char-badge char2-badge">CHAR2:</span>
                                    <span class="char-badge char3-badge">CHAR3:</span>
                                    <span class="char-badge" style="background: #6c757d; color: white;">NARRATOR:</span>
                                </div>
                            </div>
                            
                            <!-- Character Settings -->
                            <div class="accordion settings-accordion mb-3" id="multiAccordion">
                                <!-- Character 1 -->
                                <div class="accordion-item">
                                    <h2 class="accordion-header">
                                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#char1Settings">
                                            <i class="fas fa-user me-2"></i> Nhân vật 1 (CHAR1)
                                        </button>
                                    </h2>
                                    <div id="char1Settings" class="accordion-collapse collapse show">
                                        <div class="accordion-body">
                                            <div class="row g-3">
                                                <div class="col-md-6">
                                                    <label class="form-label">Ngôn ngữ</label>
                                                    <select class="form-select multi-char-language" data-char="1">
                                                        <option value="vi-VN">Tiếng Việt</option>
                                                        <option value="en-US">English (US)</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">Giọng đọc</label>
                                                    <select class="form-select multi-char-voice" data-char="1">
                                                        <option value="vi-VN-HoaiMyNeural">Hoài My (Nữ)</option>
                                                        <option value="vi-VN-NamMinhNeural">Nam Minh (Nam)</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="slider-container">
                                                <label class="form-label">Tốc độ: <span class="multi-char-rate-value" data-char="1">0%</span></label>
                                                <input type="range" class="form-range multi-char-rate" data-char="1" min="-50" max="50" value="0">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Character 2 -->
                                <div class="accordion-item">
                                    <h2 class="accordion-header">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#char2Settings">
                                            <i class="fas fa-user me-2"></i> Nhân vật 2 (CHAR2)
                                        </button>
                                    </h2>
                                    <div id="char2Settings" class="accordion-collapse collapse">
                                        <div class="accordion-body">
                                            <div class="row g-3">
                                                <div class="col-md-6">
                                                    <label class="form-label">Ngôn ngữ</label>
                                                    <select class="form-select multi-char-language" data-char="2">
                                                        <option value="vi-VN">Tiếng Việt</option>
                                                        <option value="en-US">English (US)</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">Giọng đọc</label>
                                                    <select class="form-select multi-char-voice" data-char="2">
                                                        <option value="vi-VN-NamMinhNeural">Nam Minh (Nam)</option>
                                                        <option value="en-US-GuyNeural">Guy (Nam)</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="slider-container">
                                                <label class="form-label">Tốc độ: <span class="multi-char-rate-value" data-char="2">0%</span></label>
                                                <input type="range" class="form-range multi-char-rate" data-char="2" min="-50" max="50" value="0">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row g-3 mb-4">
                                <div class="col-md-6">
                                    <label for="multi-pause" class="form-label">Khoảng nghỉ giữa lời thoại</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="multi-pause" min="100" max="2000" value="500">
                                        <span class="input-group-text">ms</span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label for="multi-format" class="form-label">Định dạng đầu ra</label>
                                    <select class="form-select" id="multi-format">
                                        <option value="mp3">MP3 (Chất lượng cao)</option>
                                        <option value="wav">WAV (Không nén)</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="multi-subtitle" checked>
                                    <label class="form-check-label" for="multi-subtitle">Tạo phụ đề với tên nhân vật</label>
                                </div>
                            </div>
                            
                            <button class="btn btn-primary w-100" id="multi-generate">
                                <i class="fas fa-users me-2"></i> Tạo câu chuyện audio
                            </button>
                            
                            <div class="progress mt-3" id="multi-progress" style="display: none;">
                                <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%"></div>
                            </div>
                        </div>
                        
                        <div class="col-lg-6">
                            <div class="loading-spinner" id="multi-loading">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Đang xử lý...</span>
                                </div>
                                <p class="mt-3">Đang xử lý văn bản và tạo audio...</p>
                            </div>
                            
                            <div id="multi-results" style="display: none;">
                                <div class="mb-3">
                                    <label class="form-label">Audio đã tạo</label>
                                    <audio controls class="audio-player" id="multi-audio-player"></audio>
                                    <div class="d-flex gap-2 mt-2">
                                        <button class="btn btn-outline-primary btn-sm" id="multi-download-audio">
                                            <i class="fas fa-download me-1"></i> Tải audio
                                        </button>
                                        <button class="btn btn-outline-success btn-sm" id="multi-download-srt" style="display: none;">
                                            <i class="fas fa-file-alt me-1"></i> Tải phụ đề
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Thông tin</label>
                                    <div class="alert alert-info" id="multi-status">
                                        <i class="fas fa-info-circle me-2"></i> Chưa có audio được tạo
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Nội dung phụ đề</label>
                                    <div class="subtitle-box" id="multi-subtitles">Chưa có phụ đề</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tab 3: Q&A Dialogue -->
                <div class="tab-pane fade" id="qa" role="tabpanel">
                    <div class="row">
                        <div class="col-lg-6">
                            <div class="mb-3">
                                <label for="qa-text" class="form-label">Nội dung hội thoại</label>
                                <textarea class="form-control" id="qa-text" rows="10" placeholder="Q: Câu hỏi&#10;A: Câu trả lời&#10;Q: Câu hỏi tiếp theo&#10;A: Câu trả lời tiếp theo">Q: Text to Speech là gì?&#10;A: Text to Speech là công nghệ chuyển đổi văn bản thành giọng nói.&#10;Q: Công cụ này có những tính năng gì?&#10;A: Công cụ hỗ trợ nhiều ngôn ngữ, giọng đọc, và tạo phụ đề tự động.</textarea>
                                <div class="form-text mt-2">
                                    Sử dụng tiền tố: 
                                    <span class="char-badge q-badge">Q:</span> cho câu hỏi,
                                    <span class="char-badge a-badge">A:</span> cho câu trả lời
                                </div>
                            </div>
                            
                            <!-- Voice Settings -->
                            <div class="accordion settings-accordion mb-3" id="qaAccordion">
                                <!-- Question Settings -->
                                <div class="accordion-item">
                                    <h2 class="accordion-header">
                                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#questionSettings">
                                            <i class="fas fa-question-circle me-2"></i> Giọng câu hỏi (Q)
                                        </button>
                                    </h2>
                                    <div id="questionSettings" class="accordion-collapse collapse show">
                                        <div class="accordion-body">
                                            <div class="row g-3">
                                                <div class="col-md-6">
                                                    <label class="form-label">Ngôn ngữ</label>
                                                    <select class="form-select" id="qa-language-q">
                                                        <option value="vi-VN">Tiếng Việt</option>
                                                        <option value="en-US">English (US)</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">Giọng đọc</label>
                                                    <select class="form-select" id="qa-voice-q">
                                                        <option value="vi-VN-HoaiMyNeural">Hoài My (Nữ)</option>
                                                        <option value="en-US-JennyNeural">Jenny (Nữ)</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="slider-container">
                                                <label class="form-label">Tốc độ: <span id="qa-rate-q-value">0%</span></label>
                                                <input type="range" class="form-range" id="qa-rate-q" min="-50" max="50" value="0">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Answer Settings -->
                                <div class="accordion-item">
                                    <h2 class="accordion-header">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#answerSettings">
                                            <i class="fas fa-comment-dots me-2"></i> Giọng câu trả lời (A)
                                        </button>
                                    </h2>
                                    <div id="answerSettings" class="accordion-collapse collapse">
                                        <div class="accordion-body">
                                            <div class="row g-3">
                                                <div class="col-md-6">
                                                    <label class="form-label">Ngôn ngữ</label>
                                                    <select class="form-select" id="qa-language-a">
                                                        <option value="vi-VN">Tiếng Việt</option>
                                                        <option value="en-US">English (US)</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">Giọng đọc</label>
                                                    <select class="form-select" id="qa-voice-a">
                                                        <option value="vi-VN-NamMinhNeural">Nam Minh (Nam)</option>
                                                        <option value="en-US-GuyNeural">Guy (Nam)</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="slider-container">
                                                <label class="form-label">Tốc độ: <span id="qa-rate-a-value">0%</span></label>
                                                <input type="range" class="form-range" id="qa-rate-a" min="-50" max="50" value="0">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row g-3 mb-4">
                                <div class="col-md-4">
                                    <label for="qa-repeat" class="form-label">Lặp lại mỗi cặp</label>
                                    <input type="number" class="form-control" id="qa-repeat" min="1" max="3" value="1">
                                </div>
                                <div class="col-md-4">
                                    <label for="qa-pause-q" class="form-label">Nghỉ sau câu hỏi</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="qa-pause-q" min="100" max="1000" value="300">
                                        <span class="input-group-text">ms</span>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <label for="qa-pause-a" class="form-label">Nghỉ sau câu trả lời</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="qa-pause-a" min="100" max="2000" value="500">
                                        <span class="input-group-text">ms</span>
                                    </div>
                                </div>
                            </div>
                            
                            <button class="btn btn-primary w-100" id="qa-generate">
                                <i class="fas fa-comments me-2"></i> Tạo audio hội thoại
                            </button>
                            
                            <div class="progress mt-3" id="qa-progress" style="display: none;">
                                <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%"></div>
                            </div>
                        </div>
                        
                        <div class="col-lg-6">
                            <div class="loading-spinner" id="qa-loading">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Đang xử lý...</span>
                                </div>
                                <p class="mt-3">Đang xử lý văn bản và tạo audio...</p>
                            </div>
                            
                            <div id="qa-results" style="display: none;">
                                <div class="mb-3">
                                    <label class="form-label">Audio đã tạo</label>
                                    <audio controls class="audio-player" id="qa-audio-player"></audio>
                                    <div class="d-flex gap-2 mt-2">
                                        <button class="btn btn-outline-primary btn-sm" id="qa-download-audio">
                                            <i class="fas fa-download me-1"></i> Tải audio
                                        </button>
                                        <button class="btn btn-outline-success btn-sm" id="qa-download-srt" style="display: none;">
                                            <i class="fas fa-file-alt me-1"></i> Tải phụ đề
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Thông tin</label>
                                    <div class="alert alert-info" id="qa-status">
                                        <i class="fas fa-info-circle me-2"></i> Chưa có audio được tạo
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Nội dung phụ đề</label>
                                    <div class="subtitle-box" id="qa-subtitles">Chưa có phụ đề</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Features Section -->
        <div class="row mt-5">
            <div class="col-md-4 mb-4">
                <div class="card h-100 text-center">
                    <div class="card-body">
                        <div class="feature-icon">
                            <i class="fas fa-language"></i>
                        </div>
                        <h5 class="card-title">Đa Ngôn Ngữ</h5>
                        <p class="card-text">Hỗ trợ nhiều ngôn ngữ với giọng đọc tự nhiên từ Microsoft Edge TTS</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-4">
                <div class="card h-100 text-center">
                    <div class="card-body">
                        <div class="feature-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <h5 class="card-title">Đa Nhân Vật</h5>
                        <p class="card-text">Tạo hội thoại với nhiều nhân vật, mỗi nhân vật có giọng đọc riêng biệt</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-4">
                <div class="card h-100 text-center">
                    <div class="card-body">
                        <div class="feature-icon">
                            <i class="fas fa-closed-captioning"></i>
                        </div>
                        <h5 class="card-title">Phụ đề Tự động</h5>
                        <p class="card-text">Tự động tạo phụ đề SRT đồng bộ thời gian với audio</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="footer">
            <p>Text to Speech Studio - Công cụ chuyển văn bản thành giọng nói chuyên nghiệp</p>
            <p class="text-muted">
                <small>Powered by Microsoft Edge TTS | Tự động tạo phụ đề | Hỗ trợ đa ngôn ngữ</small>
            </p>
        </div>
    </div>

    <!-- JavaScript Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Main Application Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Language Management
            const languageSelect = document.getElementById('language-select');
            const voiceData = {
                'vi-VN': [
                    { value: 'vi-VN-HoaiMyNeural', text: 'Hoài My (Nữ)' },
                    { value: 'vi-VN-NamMinhNeural', text: 'Nam Minh (Nam)' }
                ],
                'en-US': [
                    { value: 'en-US-JennyNeural', text: 'Jenny (Nữ)' },
                    { value: 'en-US-GuyNeural', text: 'Guy (Nam)' },
                    { value: 'en-US-AriaNeural', text: 'Aria (Nữ)' },
                    { value: 'en-US-DavisNeural', text: 'Davis (Nam)' }
                ],
                'en-GB': [
                    { value: 'en-GB-SoniaNeural', text: 'Sonia (Nữ)' },
                    { value: 'en-GB-RyanNeural', text: 'Ryan (Nam)' }
                ],
                'fr-FR': [
                    { value: 'fr-FR-DeniseNeural', text: 'Denise (Nữ)' },
                    { value: 'fr-FR-HenriNeural', text: 'Henri (Nam)' }
                ],
                'es-ES': [
                    { value: 'es-ES-ElviraNeural', text: 'Elvira (Nữ)' },
                    { value: 'es-ES-AlvaroNeural', text: 'Alvaro (Nam)' }
                ],
                'de-DE': [
                    { value: 'de-DE-KatjaNeural', text: 'Katja (Nữ)' },
                    { value: 'de-DE-ConradNeural', text: 'Conrad (Nam)' }
                ],
                'ja-JP': [
                    { value: 'ja-JP-NanamiNeural', text: 'Nanami (Nữ)' },
                    { value: 'ja-JP-KeitaNeural', text: 'Keita (Nam)' }
                ],
                'ko-KR': [
                    { value: 'ko-KR-SunHiNeural', text: 'SunHi (Nữ)' },
                    { value: 'ko-KR-InJoonNeural', text: 'InJoon (Nam)' }
                ],
                'zh-CN': [
                    { value: 'zh-CN-XiaoxiaoNeural', text: 'Xiaoxiao (Nữ)' },
                    { value: 'zh-CN-YunxiNeural', text: 'Yunxi (Nam)' }
                ]
            };
            
            function updateVoices(language) {
                const voices = voiceData[language] || voiceData['vi-VN'];
                const singleVoiceSelect = document.getElementById('single-voice');
                singleVoiceSelect.innerHTML = '';
                
                voices.forEach(voice => {
                    const option = document.createElement('option');
                    option.value = voice.value;
                    option.textContent = voice.text;
                    singleVoiceSelect.appendChild(option);
                });
                
                // Update character voices if they match the language
                document.querySelectorAll('.multi-char-language').forEach(select => {
                    if (select.value === language) {
                        const char = select.getAttribute('data-char');
                        const voiceSelect = document.querySelector(`.multi-char-voice[data-char="${char}"]`);
                        voiceSelect.innerHTML = '';
                        voices.forEach(voice => {
                            const option = document.createElement('option');
                            option.value = voice.value;
                            option.textContent = voice.text;
                            voiceSelect.appendChild(option);
                        });
                    }
                });
            }
            
            // Initialize voices
            updateVoices('vi-VN');
            
            document.getElementById('single-language').addEventListener('change', function() {
                updateVoices(this.value);
            });
            
            // Slider Value Updates
            function updateSliderValues() {
                // Single character sliders
                document.getElementById('single-rate-value').textContent = 
                    document.getElementById('single-rate').value + '%';
                document.getElementById('single-volume-value').textContent = 
                    document.getElementById('single-volume').value + '%';
                document.getElementById('single-pause-value').textContent = 
                    document.getElementById('single-pause').value + 'ms';
                
                // Multi character sliders
                document.querySelectorAll('.multi-char-rate').forEach(slider => {
                    const char = slider.getAttribute('data-char');
                    const valueSpan = document.querySelector(`.multi-char-rate-value[data-char="${char}"]`);
                    valueSpan.textContent = slider.value + '%';
                });
                
                // Q&A sliders
                document.getElementById('qa-rate-q-value').textContent = 
                    document.getElementById('qa-rate-q').value + '%';
                document.getElementById('qa-rate-a-value').textContent = 
                    document.getElementById('qa-rate-a').value + '%';
            }
            
            // Attach slider events
            document.querySelectorAll('input[type="range"]').forEach(slider => {
                slider.addEventListener('input', updateSliderValues);
            });
            
            // Initialize slider values
            updateSliderValues();
            
            // Audio Generation using Edge TTS via Serverless Function
            async function generateTTS(text, voice, rate, volume) {
                try {
                    // Using a public Edge TTS proxy service
                    const response = await fetch(`https://edge-tts-proxy.vercel.app/api/tts`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            text: text,
                            voice: voice,
                            rate: `${rate > 0 ? '+' : ''}${rate}%`,
                            volume: `${volume}%`
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const audioBlob = await response.blob();
                    return URL.createObjectURL(audioBlob);
                } catch (error) {
                    console.error('TTS Error:', error);
                    throw error;
                }
            }
            
            // Generate subtitles from text
            function generateSubtitles(text, charType = null) {
                const lines = text.split('\n').filter(line => line.trim());
                let subtitles = '';
                let startTime = 0;
                
                lines.forEach((line, index) => {
                    const duration = Math.max(2000, line.length * 50); // 50ms per character, minimum 2 seconds
                    const endTime = startTime + duration;
                    
                    // Format time for SRT
                    const formatTime = (ms) => {
                        const hours = Math.floor(ms / 3600000);
                        const minutes = Math.floor((ms % 3600000) / 60000);
                        const seconds = Math.floor((ms % 60000) / 1000);
                        const milliseconds = ms % 1000;
                        
                        return `${hours.toString().padStart(2, '0')}:` +
                               `${minutes.toString().padStart(2, '0')}:` +
                               `${seconds.toString().padStart(2, '0')},` +
                               `${milliseconds.toString().padStart(3, '0')}`;
                    };
                    
                    subtitles += `${index + 1}\n`;
                    subtitles += `${formatTime(startTime)} --> ${formatTime(endTime)}\n`;
                    
                    if (charType === 'multi') {
                        const match = line.match(/^(CHAR[123]|NARRATOR):\s*(.*)/i);
                        if (match) {
                            subtitles += `${match[1]}: ${match[2]}\n\n`;
                        } else {
                            subtitles += `${line}\n\n`;
                        }
                    } else if (charType === 'qa') {
                        const match = line.match(/^([QA]):\s*(.*)/i);
                        if (match) {
                            subtitles += `${match[1]}: ${match[2]}\n\n`;
                        } else {
                            subtitles += `${line}\n\n`;
                        }
                    } else {
                        subtitles += `${line}\n\n`;
                    }
                    
                    startTime = endTime + 100; // Add 100ms pause between lines
                });
                
                return subtitles;
            }
            
            // Single Character Tab
            document.getElementById('single-generate').addEventListener('click', async function() {
                const text = document.getElementById('single-text').value.trim();
                const voice = document.getElementById('single-voice').value;
                const rate = parseInt(document.getElementById('single-rate').value);
                const volume = parseInt(document.getElementById('single-volume').value);
                const pause = parseInt(document.getElementById('single-pause').value);
                const generateSubtitle = document.getElementById('single-subtitle').checked;
                
                if (!text) {
                    showAlert('Vui lòng nhập nội dung văn bản', 'warning');
                    return;
                }
                
                if (text.length > 5000) {
                    showAlert('Văn bản quá dài (tối đa 5000 ký tự)', 'warning');
                    return;
                }
                
                // Show loading
                document.getElementById('single-loading').style.display = 'block';
                document.getElementById('single-results').style.display = 'none';
                document.getElementById('single-progress').style.display = 'block';
                
                try {
                    // Update progress
                    const progressBar = document.querySelector('#single-progress .progress-bar');
                    progressBar.style.width = '30%';
                    
                    // Generate audio
                    const audioUrl = await generateTTS(text, voice, rate, volume);
                    progressBar.style.width = '70%';
                    
                    // Generate subtitles if requested
                    let subtitles = '';
                    if (generateSubtitle) {
                        subtitles = generateSubtitles(text);
                        progressBar.style.width = '100%';
                    }
                    
                    // Hide loading and show results
                    setTimeout(() => {
                        document.getElementById('single-loading').style.display = 'none';
                        document.getElementById('single-progress').style.display = 'none';
                        document.getElementById('single-results').style.display = 'block';
                        
                        const audioPlayer = document.getElementById('single-audio-player');
                        audioPlayer.src = audioUrl;
                        
                        document.getElementById('single-status').className = 'alert alert-success';
                        document.getElementById('single-status').innerHTML = 
                            `<i class="fas fa-check-circle me-2"></i> Đã tạo audio thành công! ${text.length} ký tự`;
                        
                        if (generateSubtitle) {
                            document.getElementById('single-subtitles').textContent = subtitles;
                            document.getElementById('single-download-srt').style.display = 'block';
                        } else {
                            document.getElementById('single-subtitles').textContent = 'Không tạo phụ đề';
                            document.getElementById('single-download-srt').style.display = 'none';
                        }
                        
                        // Setup download buttons
                        document.getElementById('single-download-audio').onclick = function() {
                            downloadFile(audioUrl, 'single_audio.mp3');
                        };
                        
                        document.getElementById('single-download-srt').onclick = function() {
                            const blob = new Blob([subtitles], { type: 'text/plain' });
                            const url = URL.createObjectURL(blob);
                            downloadFile(url, 'subtitles.srt');
                        };
                        
                        // Save settings if checked
                        if (document.getElementById('single-save-settings').checked) {
                            saveSettings('single', {
                                language: document.getElementById('single-language').value,
                                voice: voice,
                                rate: rate,
                                volume: volume,
                                pause: pause
                            });
                        }
                    }, 500);
                    
                } catch (error) {
                    document.getElementById('single-loading').style.display = 'none';
                    document.getElementById('single-progress').style.display = 'none';
                    
                    document.getElementById('single-status').className = 'alert alert-danger';
                    document.getElementById('single-status').innerHTML = 
                        `<i class="fas fa-exclamation-circle me-2"></i> Lỗi: ${error.message}`;
                    document.getElementById('single-results').style.display = 'block';
                    
                    console.error('Audio generation failed:', error);
                }
            });
            
            // Multi Character Tab
            document.getElementById('multi-generate').addEventListener('click', async function() {
                const text = document.getElementById('multi-text').value.trim();
                const pause = parseInt(document.getElementById('multi-pause').value);
                const format = document.getElementById('multi-format').value;
                const generateSubtitle = document.getElementById('multi-subtitle').checked;
                
                if (!text) {
                    showAlert('Vui lòng nhập nội dung hội thoại', 'warning');
                    return;
                }
                
                // Parse dialogue lines
                const lines = text.split('\n').filter(line => line.trim());
                const dialogues = [];
                
                lines.forEach(line => {
                    const match = line.match(/^(CHAR[123]|NARRATOR):\s*(.*)/i);
                    if (match) {
                        dialogues.push({
                            character: match[1].toUpperCase(),
                            text: match[2]
                        });
                    } else {
                        // If no character prefix, add to previous line
                        if (dialogues.length > 0) {
                            dialogues[dialogues.length - 1].text += ' ' + line;
                        }
                    }
                });
                
                if (dialogues.length === 0) {
                    showAlert('Không tìm thấy lời thoại với định dạng CHAR1:, CHAR2:, CHAR3: hoặc NARRATOR:', 'warning');
                    return;
                }
                
                // Show loading
                document.getElementById('multi-loading').style.display = 'block';
                document.getElementById('multi-results').style.display = 'none';
                document.getElementById('multi-progress').style.display = 'block';
                
                try {
                    const progressBar = document.querySelector('#multi-progress .progress-bar');
                    const audioSegments = [];
                    
                    // Generate audio for each dialogue
                    for (let i = 0; i < dialogues.length; i++) {
                        const dialogue = dialogues[i];
                        const charNum = dialogue.character === 'CHAR1' ? 1 : 
                                        dialogue.character === 'CHAR2' ? 2 : 1; // Default to CHAR1 for others
                        
                        const voiceSelect = document.querySelector(`.multi-char-voice[data-char="${charNum}"]`);
                        const rateSelect = document.querySelector(`.multi-char-rate[data-char="${charNum}"]`);
                        
                        progressBar.style.width = `${(i / dialogues.length) * 80}%`;
                        
                        try {
                            const audioUrl = await generateTTS(
                                dialogue.text,
                                voiceSelect.value,
                                parseInt(rateSelect.value),
                                100
                            );
                            
                            audioSegments.push({
                                url: audioUrl,
                                character: dialogue.character,
                                text: dialogue.text
                            });
                        } catch (error) {
                            console.error(`Failed to generate audio for ${dialogue.character}:`, error);
                        }
                    }
                    
                    // Combine audio segments
                    if (audioSegments.length > 0) {
                        progressBar.style.width = '90%';
                        
                        // For simplicity, we'll use the first audio as combined audio
                        // In a real implementation, you would merge all audio segments
                        const combinedAudioUrl = audioSegments[0].url;
                        
                        // Generate subtitles
                        let subtitles = '';
                        if (generateSubtitle) {
                            subtitles = generateSubtitles(text, 'multi');
                            progressBar.style.width = '100%';
                        }
                        
                        // Hide loading and show results
                        setTimeout(() => {
                            document.getElementById('multi-loading').style.display = 'none';
                            document.getElementById('multi-progress').style.display = 'none';
                            document.getElementById('multi-results').style.display = 'block';
                            
                            const audioPlayer = document.getElementById('multi-audio-player');
                            audioPlayer.src = combinedAudioUrl;
                            
                            document.getElementById('multi-status').className = 'alert alert-success';
                            document.getElementById('multi-status').innerHTML = 
                                `<i class="fas fa-check-circle me-2"></i> Đã tạo audio cho ${dialogues.length} lời thoại`;
                            
                            if (generateSubtitle) {
                                document.getElementById('multi-subtitles').textContent = subtitles;
                                document.getElementById('multi-download-srt').style.display = 'block';
                            } else {
                                document.getElementById('multi-subtitles').textContent = 'Không tạo phụ đề';
                                document.getElementById('multi-download-srt').style.display = 'none';
                            }
                            
                            // Setup download buttons
                            document.getElementById('multi-download-audio').onclick = function() {
                                downloadFile(combinedAudioUrl, 'multi_character_audio.mp3');
                            };
                            
                            document.getElementById('multi-download-srt').onclick = function() {
                                const blob = new Blob([subtitles], { type: 'text/plain' });
                                const url = URL.createObjectURL(blob);
                                downloadFile(url, 'multi_character_subtitles.srt');
                            };
                        }, 500);
                    } else {
                        throw new Error('Không thể tạo audio cho bất kỳ lời thoại nào');
                    }
                    
                } catch (error) {
                    document.getElementById('multi-loading').style.display = 'none';
                    document.getElementById('multi-progress').style.display = 'none';
                    
                    document.getElementById('multi-status').className = 'alert alert-danger';
                    document.getElementById('multi-status').innerHTML = 
                        `<i class="fas fa-exclamation-circle me-2"></i> Lỗi: ${error.message}`;
                    document.getElementById('multi-results').style.display = 'block';
                    
                    console.error('Multi-character audio generation failed:', error);
                }
            });
            
            // Q&A Tab
            document.getElementById('qa-generate').addEventListener('click', async function() {
                const text = document.getElementById('qa-text').value.trim();
                const repeat = parseInt(document.getElementById('qa-repeat').value);
                const pauseQ = parseInt(document.getElementById('qa-pause-q').value);
                const pauseA = parseInt(document.getElementById('qa-pause-a').value);
                
                if (!text) {
                    showAlert('Vui lòng nhập nội dung hỏi đáp', 'warning');
                    return;
                }
                
                // Parse Q&A lines
                const lines = text.split('\n').filter(line => line.trim());
                const qaPairs = [];
                let currentPair = null;
                
                lines.forEach(line => {
                    const match = line.match(/^([QA]):\s*(.*)/i);
                    if (match) {
                        const type = match[1].toUpperCase();
                        const content = match[2];
                        
                        if (type === 'Q') {
                            if (currentPair) qaPairs.push(currentPair);
                            currentPair = { Q: content, A: '' };
                        } else if (type === 'A' && currentPair) {
                            currentPair.A = content;
                        }
                    } else if (currentPair) {
                        // Append to current line
                        if (line.toLowerCase().startsWith('q:')) {
                            if (currentPair.Q) qaPairs.push(currentPair);
                            currentPair = { Q: line.substring(2).trim(), A: '' };
                        } else if (line.toLowerCase().startsWith('a:')) {
                            if (currentPair) currentPair.A = line.substring(2).trim();
                        } else {
                            // Append to last element
                            if (currentPair.A === '') {
                                currentPair.Q += ' ' + line;
                            } else {
                                currentPair.A += ' ' + line;
                            }
                        }
                    }
                });
                
                if (currentPair) qaPairs.push(currentPair);
                
                if (qaPairs.length === 0) {
                    showAlert('Không tìm thấy cặp hỏi đáp với định dạng Q: và A:', 'warning');
                    return;
                }
                
                // Show loading
                document.getElementById('qa-loading').style.display = 'block';
                document.getElementById('qa-results').style.display = 'none';
                document.getElementById('qa-progress').style.display = 'block';
                
                try {
                    const progressBar = document.querySelector('#qa-progress .progress-bar');
                    const audioSegments = [];
                    
                    // Generate audio for each Q&A pair
                    for (let i = 0; i < qaPairs.length; i++) {
                        const pair = qaPairs[i];
                        
                        // Generate Q audio
                        progressBar.style.width = `${(i / qaPairs.length) * 40}%`;
                        try {
                            const qAudioUrl = await generateTTS(
                                pair.Q,
                                document.getElementById('qa-voice-q').value,
                                parseInt(document.getElementById('qa-rate-q').value),
                                100
                            );
                            audioSegments.push({ type: 'Q', url: qAudioUrl, text: pair.Q });
                        } catch (error) {
                            console.error('Failed to generate Q audio:', error);
                        }
                        
                        // Generate A audio
                        progressBar.style.width = `${40 + (i / qaPairs.length) * 40}%`;
                        try {
                            const aAudioUrl = await generateTTS(
                                pair.A,
                                document.getElementById('qa-voice-a').value,
                                parseInt(document.getElementById('qa-rate-a').value),
                                100
                            );
                            audioSegments.push({ type: 'A', url: aAudioUrl, text: pair.A });
                        } catch (error) {
                            console.error('Failed to generate A audio:', error);
                        }
                    }
                    
                    if (audioSegments.length > 0) {
                        progressBar.style.width = '90%';
                        
                        // Use first Q audio as combined audio for demo
                        const combinedAudioUrl = audioSegments.find(seg => seg.type === 'Q')?.url || audioSegments[0].url;
                        
                        // Generate subtitles
                        const subtitles = generateSubtitles(text, 'qa');
                        progressBar.style.width = '100%';
                        
                        // Hide loading and show results
                        setTimeout(() => {
                            document.getElementById('qa-loading').style.display = 'none';
                            document.getElementById('qa-progress').style.display = 'none';
                            document.getElementById('qa-results').style.display = 'block';
                            
                            const audioPlayer = document.getElementById('qa-audio-player');
                            audioPlayer.src = combinedAudioUrl;
                            
                            document.getElementById('qa-status').className = 'alert alert-success';
                            document.getElementById('qa-status').innerHTML = 
                                `<i class="fas fa-check-circle me-2"></i> Đã tạo audio cho ${qaPairs.length} cặp hỏi đáp`;
                            
                            document.getElementById('qa-subtitles').textContent = subtitles;
                            document.getElementById('qa-download-srt').style.display = 'block';
                            
                            // Setup download buttons
                            document.getElementById('qa-download-audio').onclick = function() {
                                downloadFile(combinedAudioUrl, 'qa_dialogue_audio.mp3');
                            };
                            
                            document.getElementById('qa-download-srt').onclick = function() {
                                const blob = new Blob([subtitles], { type: 'text/plain' });
                                const url = URL.createObjectURL(blob);
                                downloadFile(url, 'qa_subtitles.srt');
                            };
                        }, 500);
                    } else {
                        throw new Error('Không thể tạo audio cho hỏi đáp');
                    }
                    
                } catch (error) {
                    document.getElementById('qa-loading').style.display = 'none';
                    document.getElementById('qa-progress').style.display = 'none';
                    
                    document.getElementById('qa-status').className = 'alert alert-danger';
                    document.getElementById('qa-status').innerHTML = 
                        `<i class="fas fa-exclamation-circle me-2"></i> Lỗi: ${error.message}`;
                    document.getElementById('qa-results').style.display = 'block';
                    
                    console.error('Q&A audio generation failed:', error);
                }
            });
            
            // Helper functions
            function showAlert(message, type = 'info') {
                const alertDiv = document.createElement('div');
                alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
                alertDiv.innerHTML = `
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                `;
                
                const container = document.querySelector('.container');
                container.insertBefore(alertDiv, container.firstChild);
                
                setTimeout(() => {
                    alertDiv.remove();
                }, 5000);
            }
            
            function downloadFile(url, filename) {
                const link = document.createElement('a');
                link.href = url;
                link.download = filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
            
            function saveSettings(key, settings) {
                try {
                    const allSettings = JSON.parse(localStorage.getItem('tts_settings') || '{}');
                    allSettings[key] = settings;
                    localStorage.setItem('tts_settings', JSON.stringify(allSettings));
                    showAlert('Đã lưu cài đặt', 'success');
                } catch (error) {
                    console.error('Failed to save settings:', error);
                }
            }
            
            function loadSettings() {
                try {
                    const allSettings = JSON.parse(localStorage.getItem('tts_settings') || '{}');
                    
                    // Load single character settings
                    if (allSettings.single) {
                        const s = allSettings.single;
                        document.getElementById('single-language').value = s.language || 'vi-VN';
                        updateVoices(s.language || 'vi-VN');
                        document.getElementById('single-voice').value = s.voice || 'vi-VN-HoaiMyNeural';
                        document.getElementById('single-rate').value = s.rate || 0;
                        document.getElementById('single-volume').value = s.volume || 100;
                        document.getElementById('single-pause').value = s.pause || 300;
                        updateSliderValues();
                    }
                } catch (error) {
                    console.error('Failed to load settings:', error);
                }
            }
            
            // Load saved settings on page load
            loadSettings();
            
            // Language selector for UI
            languageSelect.addEventListener('change', function() {
                const lang = this.value;
                if (lang === 'en') {
                    document.getElementById('title').textContent = 'Text to Speech Studio';
                    document.getElementById('subtitle').textContent = 'Convert text to professional speech with Microsoft Edge TTS';
                    // Update other text elements as needed
                } else {
                    document.getElementById('title').textContent = 'Text to Speech Studio';
                    document.getElementById('subtitle').textContent = 'Chuyển văn bản thành giọng nói chuyên nghiệp với Microsoft Edge TTS';
                }
            });
            
            // Sample button for testing
            const sampleButton = document.createElement('button');
            sampleButton.className = 'btn btn-outline-secondary btn-sm mt-2';
            sampleButton.innerHTML = '<i class="fas fa-magic me-1"></i> Tải nội dung mẫu';
            sampleButton.onclick = function() {
                const tab = document.querySelector('.nav-link.active').id.replace('-tab', '');
                const samples = {
                    single: "Xin chào! Đây là bản demo của công cụ Text to Speech.\n\nCông cụ này sử dụng công nghệ Microsoft Edge TTS để chuyển văn bản thành giọng nói tự nhiên với chất lượng cao.\n\nBạn có thể điều chỉnh tốc độ đọc, âm lượng, và chọn giọng đọc phù hợp với nhiều ngôn ngữ khác nhau.\n\nHãy thử tạo audio và tải về để nghe kết quả!",
                    multi: "CHAR1: Xin chào các bạn, tôi là nhân vật số 1.\nCHAR2: Chào bạn, tôi rất vui được tham gia cuộc trò chuyện hôm nay.\nCHAR1: Chúng ta đang thử nghiệm công cụ Text to Speech đa nhân vật.\nCHAR2: Đúng vậy, mỗi nhân vật sẽ có giọng đọc riêng biệt.\nNARRATOR: Công nghệ này rất hữu ích cho việc tạo nội dung audio book, podcast, và các ứng dụng đa phương tiện.",
                    qa: "Q: Text to Speech là gì?\nA: Text to Speech (TTS) là công nghệ chuyển đổi văn bản thành giọng nói tự nhiên.\n\nQ: Công cụ này có những tính năng gì nổi bật?\nA: Công cụ hỗ trợ đa ngôn ngữ, nhiều giọng đọc, điều chỉnh tốc độ/âm lượng, và tự động tạo phụ đề.\n\nQ: Làm thế nào để sử dụng công cụ này?\nA: Rất đơn giản: nhập văn bản, chọn giọng đọc, điều chỉnh thông số và bấm nút tạo audio."
                };
                
                if (samples[tab]) {
                    const textarea = document.getElementById(`${tab}-text`);
                    if (textarea) {
                        textarea.value = samples[tab];
                        showAlert('Đã tải nội dung mẫu', 'success');
                    }
                }
            };
            
            // Add sample button to each tab
            ['single', 'multi', 'qa'].forEach(tab => {
                const textarea = document.getElementById(`${tab}-text`);
                if (textarea) {
                    const parent = textarea.parentNode;
                    const clone = sampleButton.cloneNode(true);
                    clone.onclick = sampleButton.onclick;
                    parent.appendChild(clone);
                }
            });
        });
    </script>
</body>
</html>
